### Splat parameter estimation

In order to easily generate a simulation that is similar to a given dataset Splatter includes functions to estimate the parameters for each simulation from real datasets. Just as with the simulations themselves the estimation procedures are based on what has been published and there is variation in how many parameters can be estimated for each model. We have given significant attention to estimating the parameters for the Splat simulation. The parameters that control the mean expression of each gene (\(\alpha\) and \(\beta\)) are estimated by fitting a gamma distribution to the winsorized means of the library size normalised counts using the fitdistrplus package \cite{Delignette_Muller_2015}. This is a basic normalisation where the counts in the original dataset are adjusted so that each has the same number of total counts (in this case the median across all cells) and any genes that are all zero are removed. We found that results of the fitting are affected by genes with extreme means and that this effect was mitigated by setting the top and bottom 10 percent of values to the 10th and 90th percentiles respectively. Parameters for the library size distribution (\(\mu^{L}\) and \(\sigma^{L}\)) are estimated in a similar way by fitting a log-normal distribution to the unnormalised library sizes.

The procedure for estimating expression outlier parameters is more complex. Taking the library size normalised counts, outliers are defined as genes where the mean expression is more than two Median Absolute Deviations (MADs) greater than the median mean gene expression level. The outlier probability \(\pi^{O}\) is then calculated as the proportion of genes that are outliers. Parameters for the outlier factors (\(\mu^{O}\) and \(\sigma^{O}\)) are estimated by fitting a log-normal distribution to the ratio of the means of the outlier genes to the median mean gene expression level.

BCV parameters are estimated using the estimateDispersion function in the edgeR package \cite{Robinson_2009}. When testing the estimation procedure on simulated datasets we observed that the edgeR estimate of common dispersion was inflated (Supplementary Figure X), therefore we apply a linear correction to this value (\(\hat{\phi} = 0.1 + 0.25\hat{\phi}_\textrm{edgeR}\)).

The midpoint (\(x_0\)) and shape (\(k\)) parameters for the dropout function are estimated by fitting a logistic function to the relationship between the log means of the normalised counts and the proportion of samples that are zero for each gene (Supplementary Figure X).

### Datasets

Each of the datasets used in the comparison of simulations is publicly available. Raw FASTQ files for the Camp dataset were download from SRA (Accession SRP066834) and processed using a Bpipe (v0.9.9.3) pipeline that examined the quality of reads using FastQC (v0.11.4), aligned the reads to the hg38 reference genome using STAR (v2.5.2a) \cite{Dobin_2012} and counted reads overlapping genes in the Gencode V22 annotation using featureCounts (v1.5.0-p3) \cite{Liao_2013}. Matrices of expression values for the Klein (Accession GSM1599500) and Zeisel (Accession GSE60361) datasets were download from GEO. For the Tung dataset the matrix of molecules aligned to each gene available from https://github.com/jdblischak/singleCellSeq was used. This data is also available from GEO (Accession GSE77288). The Salmon \cite{Patro_2017} quantification files for the Engel dataset were download from the Conquer database (http://imlspenticton.uzh.ch:3838/conquer/) and converted to a gene by cell matrix using the tximport \cite{Soneson_2015} package.

### Simulation comparison

For each dataset the data file was read into R and converted to a gene by cell matrix. Any genes that had zero expression in all cells or any missing values were filtered out and 200 cells were randomly selected without replacement. The parameters for each simulation were estimated from the selected cells and a synthetic dataset generated with 200 cells and the same number of genes as the real data. For the Splat and Lun 2 simulations both the regular and zero-inflated variants were used to simulate data. The resulting seven simulations were then compared to the real data using Splatter's comparison functions and plots showing the overall comparison produced. In order to compare simulations across the datasets summary statistics were calculated. For each of the basic metrics (mean, variance, library size, zeros per gene and zeros per cell) the genes were sorted individually for each simulation and the difference from the sorted values in the real data calculated. When looking at the relationship between mean expression level and other metrics (variance, zeros per gene) genes in both the real and simulated data were sorted by mean expression and the difference between the other metric of interest (eg. variance) calculated. The Median Absolute Deviation for each metric was then calculated and ranked for each dataset to give the rankings shown in Figure \ref{fig:comparison}.

### Clustering evaluation

Parameters for the example estimation of SC3 were estimated from the Tung dataset. Twenty synthetic datasets were generated using these parameters with different random seeds. Each simulation had three groups of different sizes (200, 100 and 50 cells) and a probability of a gene being differenially expressed of 0.1. Factors for differentially expressed genes were generated from a log-normal distribution with location parameter equal to -0.1 and scale parameter equal to 0.3. For each simulation the SC3 package was used to cluster cells with k = 3 and asked to detect DE and marker genes, taking those with p-values less than 0.05. Clustering metrics were calculated using the clues package \cite{Chang_2010} and metrics for evaluation of DE and marker genes calculated by looking at the numbers of true negatives, true positive, false negatives and false positives. Metrics were combined across the 20 simulations and boxplots produced using the ggplot2 package \cite{Wickham2010-zq}.
